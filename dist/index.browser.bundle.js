var t={228:t=>{var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var f=new o(r,s||t,i),c=n?n+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],f]:t._events[c].push(f):(t._events[c]=f,t._eventsCount++),t}function i(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function f(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),f.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},f.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},f.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},f.prototype.emit=function(t,e,r,o,s,i){var f=n?n+t:t;if(!this._events[f])return!1;var c,a,u=this._events[f],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,r),!0;case 4:return u.fn.call(u.context,e,r,o),!0;case 5:return u.fn.call(u.context,e,r,o,s),!0;case 6:return u.fn.call(u.context,e,r,o,s,i),!0}for(a=1,c=new Array(h-1);a<h;a++)c[a-1]=arguments[a];u.fn.apply(u.context,c)}else{var p,l=u.length;for(a=0;a<l;a++)switch(u[a].once&&this.removeListener(t,u[a].fn,void 0,!0),h){case 1:u[a].fn.call(u[a].context);break;case 2:u[a].fn.call(u[a].context,e);break;case 3:u[a].fn.call(u[a].context,e,r);break;case 4:u[a].fn.call(u[a].context,e,r,o);break;default:if(!c)for(p=1,c=new Array(h-1);p<h;p++)c[p-1]=arguments[p];u[a].fn.apply(u[a].context,c)}}return!0},f.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},f.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},f.prototype.removeListener=function(t,e,r,o){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return i(this,s),this;var f=this._events[s];if(f.fn)f.fn!==e||o&&!f.once||r&&f.context!==r||i(this,s);else{for(var c=0,a=[],u=f.length;c<u;c++)(f[c].fn!==e||o&&!f[c].once||r&&f[c].context!==r)&&a.push(f[c]);a.length?this._events[s]=1===a.length?a[0]:a:i(this,s)}return this},f.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&i(this,e)):(this._events=new r,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=n,f.EventEmitter=f,t.exports=f},270:(t,e,n)=>{var r=n(767),o=new TextDecoder,s=new TextEncoder;r.toString=function(t,e,n){return o.decode(r.subarray(t,e,n))},r.fromString=function(t){return s.encode(t)},t.exports=n(454)},767:(t,e)=>{e.concat=function(t){for(var e=t.length,n=0,r=0;r<e;++r)n+=t[r].byteLength;var o=new Uint8Array(n),s=0;for(r=0;r<e;++r){var i=t[r];o.set(i,s),s+=i.byteLength}return o},e.subarray=function(t,e,n){return e=Math.min(Math.max(0,e),t.byteLength),new Uint8Array(t.buffer,t.byteOffset+e,Math.min(Math.max(e,n),t.byteLength)-e)}},928:t=>{function e(){if(!(this instanceof e))throw new TypeError('Codecs must be constructed with the "new" keyword.');this._packers=[],this._packerClasses=[],this._unpackers={}}e.prototype.register=function(t,e,n,s){if(Array.isArray(n)&&(n=r(n)),Array.isArray(s)&&(s=r(s)),~~t!==t||!(t>=0&&t<128))throw new TypeError("Invalid extension type (must be between 0 and 127).");if("function"!=typeof e)throw new TypeError("Expected second argument to be a constructor function.");return this._packers.push((function(r){var s=n(r);if(!(s instanceof Uint8Array))throw new TypeError('Codec must return a Uint8Array (encoding "'+e.name+'").');return new o(s,t)})),this._packerClasses.push(e),this._unpackers[t]=s,this},e.prototype._packerFor=function(t){return n(t.constructor,this._packerClasses,this._packers)},e.prototype._unpackerFor=function(t){return this._unpackers[t]},t.exports=e;var n=function(t,e,n){for(var r=0,o=e.length;r<o;++r)if(t===e[r])return n[r]},r=function(t){t=t.slice();var e=function(t,e){return e(t)};return function(n){return t.reduce(e,n)}},o=function(t,e){this.buffer=t,this.etype=e}},734:(t,e,n)=>{t.exports=function(t){var e=r(t),n=o[e];if(!n)throw new Error("Invalid type: "+(e?"0x"+e.toString(16):e));return n(t)};var r=n(998).uint8,o=new Array(256);!function(t){var e,n=function(t){return function(){return t}},r=function(t,e){return function(n){return e(n,t)}},s=function(t,e){return function(n){return e(n,t(n))}};for(e=0;e<=127;++e)o[e]=n(e);for(e=128;e<=143;++e)o[e]=r(e-128,t.map);for(e=144;e<=159;++e)o[e]=r(e-144,t.array);for(e=160;e<=191;++e)o[e]=r(e-160,t.str);for(o[192]=n(null),o[193]=null,o[194]=n(!1),o[195]=n(!0),o[196]=s(t.uint8,t.bin),o[197]=s(t.uint16,t.bin),o[198]=s(t.uint32,t.bin),o[199]=s(t.uint8,t.ext),o[200]=s(t.uint16,t.ext),o[201]=s(t.uint32,t.ext),o[202]=t.float32,o[203]=t.float64,o[204]=t.uint8,o[205]=t.uint16,o[206]=t.uint32,o[207]=null,o[208]=t.int8,o[209]=t.int16,o[210]=t.int32,o[211]=null,o[212]=r(1,t.ext),o[213]=r(2,t.ext),o[214]=r(4,t.ext),o[215]=r(8,t.ext),o[216]=r(16,t.ext),o[217]=s(t.uint8,t.str),o[218]=s(t.uint16,t.str),o[219]=s(t.uint32,t.str),o[220]=s(t.uint16,t.array),o[221]=s(t.uint32,t.array),o[222]=s(t.uint16,t.map),o[223]=s(t.uint32,t.map),e=224;e<=255;++e)o[e]=n(e-256)}(n(998))},954:(t,e,n)=>{var r={},o=t.exports=function(t,e){r[typeof e](t,e)};!function(t,e){var n=new Float32Array(1);r.number=function(e,r){var o,s=r>>>0;if(r===s)s<=127?t.type(e,s):s<=255?t.int8(e,204,s):s<=65535?t.int16(e,205,s):t.int32(e,206,s);else{var i=0|r;r===i?i>=-32?t.type(e,255&i):i>=-128?t.int8(e,208,i):i>=-32768?t.int16(e,209,i):t.int32(e,210,i):(o=r,n[0]=o,n[0]===o?t.float32(e,r):t.float64(e,r))}},r.string=function(n,r){var o=e(r),s=o.byteLength;s<32?t.type(n,160+s):s<=255?t.int8(n,217,s):s<=65535?t.int16(n,218,s):t.int32(n,219,s),n.send(o)},r.boolean=function(e,n){t.type(e,n?195:194)},r.object=function(t,e){var n;return null===e?s(t,e):Array.isArray(e)?i(t,e):e instanceof Uint8Array?f(t,e):t.codec&&(n=t.codec._packerFor(e))?c(t,n(e)):void a(t,e)};var s=function(e){t.type(e,192)},i=function(e,n){var r=n.length;r<16?t.type(e,144+r):r<=65535?t.int16(e,220,r):t.int32(e,221,r);for(var s=0;s<r;++s)o(e,n[s])},f=function(e,n){var r=n.byteLength;r<=255?t.int8(e,196,r):r<=65535?t.int16(e,197,r):t.int32(e,198,r),e.send(n)},c=function(e,n){var r=n.buffer.byteLength;1===r?t.int8(e,212,n.etype):2===r?t.int8(e,213,n.etype):4===r?t.int8(e,214,n.etype):8===r?t.int8(e,215,n.etype):16===r?t.int8(e,216,n.etype):r<=255?(t.int8(e,199,r),t.type(e,n.etype)):r<=65535?(t.int16(e,200,r),t.type(e,n.etype)):(t.int32(e,201,r),t.type(e,n.etype)),e.send(n.buffer)},a=function(e,n){var r=Object.keys(n),s=r.length;s<16?t.type(e,128+s):s<=65535?t.int16(e,222,s):t.int32(e,223,s);for(var i=0;i<s;++i){var f=r[i];o(e,(f>>>0)+""===f?f>>>0:f),o(e,n[f])}};r.undefined=s,r.function=s,r.symbol=s}(n(179),n(767).fromString)},454:(t,e,n)=>{var r=n(928),o=n(116),s=n(954),i=n(734);e.encode=function(t,e){if(null!=e&&!(e instanceof r))throw new TypeError("Expected second argument to be a Codec, if provided.");var n=new o(e);return s(n,t),n.read()},e.decode=function(t,e){if(null!=e&&!(e instanceof r))throw new TypeError("Expected second argument to be a Codec, if provided.");if(!(t instanceof Uint8Array))throw new TypeError("Expected first argument to be a Uint8Array.");var n=new o(e);return n.setBuffer(t),i(n)},e.Codec=r},116:(t,e,n)=>{var r=n(767),o=function(t){this.codec=t};o.prototype.push=function(t){(this.buffers||(this.buffers=[])).push(t)},o.prototype.read=function(){this.flush();var t=this.buffers;if(t){var e=t.length>1?r.concat(t):t[0];return t.length=0,e}},o.prototype.flush=function(){this.start<this.offset&&(this.push(r.subarray(this.buffer,this.start,this.offset)),this.start=this.offset)},o.prototype.reserve=function(t){if(!this.buffer)return this.alloc(t);var e=this.buffer.byteLength;this.offset+t>e&&(this.offset&&this.flush(),this.alloc(Math.max(t,Math.min(2*e,65536))))},o.prototype.alloc=function(t){this.setBuffer(new Uint8Array(Math.max(t,2048)))},o.prototype.setBuffer=function(t){this.buffer=t,this.offset=0,this.start=0},o.prototype.send=function(t){var e=this.offset+t.byteLength;this.buffer&&e<=this.buffer.byteLength?(this.buffer.set(t,this.offset),this.offset=e):(this.flush(),this.push(t))},t.exports=o},998:(t,e,n)=>{var r=n(767),o=n(734),s=function(t){var e=t.buffer;if(t.offset>=e.byteLength)throw new RangeError("BUFFER_SHORTAGE");return e[t.offset++]},i=function(t){var e=t.buffer;if(t.offset+2>e.byteLength)throw new RangeError("BUFFER_SHORTAGE");return e[t.offset++]<<8|e[t.offset++]};t.exports={map:function(t,e){for(var n={},r=0;r<e;++r)n[o(t)]=o(t);return n},array:function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=o(t);return n},str:function(t,e){var n=t.offset,o=t.offset=n+e;if(o>t.buffer.byteLength)throw new RangeError("BUFFER_SHORTAGE");return r.toString(t.buffer,n,o)},bin:function(t,e){var n=t.offset,o=t.offset=n+e;if(o>t.buffer.byteLength)throw new RangeError("BUFFER_SHORTAGE");return r.subarray(t.buffer,n,o)},ext:function(t,e){var n=t.offset,o=t.offset=n+e+1;if(o>t.buffer.byteLength)throw new RangeError("BUFFER_SHORTAGE");var s,i=t.buffer[n];if(t.codec&&(s=t.codec._unpackerFor(i)))return s(r.subarray(t.buffer,n+1,o));throw new Error("Unrecognized extension type: "+(i?"0x"+i.toString(16):i))},uint8:s,uint16:i,uint32:function(t){var e=t.buffer;if(t.offset+4>e.byteLength)throw new RangeError("BUFFER_SHORTAGE");return 16777216*e[t.offset++]+(e[t.offset++]<<16|e[t.offset++]<<8|e[t.offset++])},int8:function(t){var e=s(t);return 128&e?-1*(255-e+1):e},int16:function(t){var e=i(t);return 32768&e?4294901760|e:e},int32:function(t){var e=t.buffer;if(t.offset+4>e.byteLength)throw new RangeError("BUFFER_SHORTAGE");return e[t.offset++]<<24|e[t.offset++]<<16|e[t.offset++]<<8|e[t.offset++]},float32:function(t){var e=t.buffer,n=t.offset;return t.offset+=4,new DataView(e.buffer).getFloat32(e.byteOffset+n)},float64:function(t){var e=t.buffer,n=t.offset;return t.offset+=8,new DataView(e.buffer).getFloat64(e.byteOffset+n)}}},179:(t,e)=>{e.type=function(t,e){t.reserve(1),t.buffer[t.offset++]=e},e.int8=function(t,e,n){t.reserve(2);var r=t.buffer;r[t.offset++]=e,r[t.offset++]=n},e.int16=function(t,e,n){t.reserve(3);var r=t.buffer;r[t.offset++]=e,r[t.offset++]=n>>>8,r[t.offset++]=n},e.int32=function(t,e,n){t.reserve(5);var r=t.buffer;r[t.offset++]=e,r[t.offset++]=n>>>24,r[t.offset++]=n>>>16,r[t.offset++]=n>>>8,r[t.offset++]=n},e.float32=function(t,e){t.reserve(5);var n=t.buffer;n[t.offset++]=202,new DataView(n.buffer).setFloat32(n.byteOffset+t.offset,e),t.offset+=4},e.float64=function(t,e){t.reserve(9);var n=t.buffer;n[t.offset++]=203,new DataView(n.buffer).setFloat64(n.byteOffset+t.offset,e),t.offset+=8}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};n.d(r,{K:()=>a});var o=n(228);class s extends o.EventEmitter{constructor(t,e,n){super(),this.socket=new WebSocket(t,n),this.socket.onopen=()=>this.emit("open"),this.socket.onmessage=t=>this.emit("message",t.data),this.socket.onerror=t=>this.emit("error",t),this.socket.onclose=t=>{this.emit("close",t.code,t.reason)}}send(t,e,n){const r=n||e;try{this.socket.send(t),r()}catch(t){r(t)}}close(t,e){this.socket.close(t,e)}addEventListener(t,e,n){this.socket.addEventListener(t,e,n)}}function i(t,e){return new s(t,e)}var f=n(270);class c extends o.EventEmitter{constructor(t,e="ws://localhost:8080",{autoconnect:n=!0,reconnect:r=!0,reconnect_interval:o=1e3,max_reconnects:s=5}={},i){super(),this.webSocketFactory=t,this.queue={},this.rpc_id=0,this.address=e,this.autoconnect=n,this.ready=!1,this.reconnect=r,this.reconnect_interval=o,this.max_reconnects=s,this.current_reconnects=0,this.generate_request_id=i||(()=>++this.rpc_id),this.autoconnect&&this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects})}connect(){this.socket||this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects})}call(t,e,n,r){return r||"object"!=typeof n||(r=n,n=null),new Promise(((o,s)=>{if(!this.ready)return s(new Error("socket not ready"));const i=this.generate_request_id(t,e),c={method:t,params:e||null,id:i};this.socket.send(f.encode(c),r,(t=>{if(t)return s(t);this.queue[i]={promise:[o,s]},n&&(this.queue[i].timeout=setTimeout((()=>{this.queue[i]=null,s(new Error("reply timeout"))}),n))}))}))}async login(t){if(!await this.call("rpc.login",t))throw new Error("authentication failed")}async listMethods(){return await this.call("__listMethods")}notify(t,e){return new Promise(((n,r)=>{if(!this.ready)return r(new Error("socket not ready"));const o={method:t,params:e||null};this.socket.send(f.encode(o),(t=>{if(t)return r(t);n()}))}))}async subscribe(t){"string"==typeof t&&(t=[t]);const e=await this.call("rpc.on",t);if("string"==typeof t&&"ok"!==e[t])throw new Error("Failed subscribing to an event '"+t+"' with: "+e[t]);return e}async unsubscribe(t){"string"==typeof t&&(t=[t]);const e=await this.call("rpc.off",t);if("string"==typeof t&&"ok"!==e[t])throw new Error("Failed unsubscribing from an event with: "+e);return e}close(t,e){this.socket.close(t||1e3,e)}_connect(t,e){this.socket=this.webSocketFactory(t,e),this.socket.addEventListener("open",(()=>{this.ready=!0,this.emit("open"),this.current_reconnects=0})),this.socket.addEventListener("message",(async({data:t})=>{"undefined"!=typeof Blob&&t instanceof Blob&&(t=new Uint8Array(await t.arrayBuffer()));try{t=f.decode(t)}catch(t){return void console.log("decode error:",t)}if(t.notification&&this.listeners(t.notification).length){if(!Object.keys(t.params).length)return this.emit(t.notification);const e=[t.notification];if(t.params.constructor===Object)e.push(t.params);else for(let n=0;n<t.params.length;n++)e.push(t.params[n]);return Promise.resolve().then((()=>{this.emit.apply(this,e)}))}if(!this.queue[t.id])return t.method&&t.params?Promise.resolve().then((()=>{this.emit(t.method,t.params)})):void 0;if("error"in t=="result"in t&&this.queue[t.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),this.queue[t.id].timeout&&clearTimeout(this.queue[t.id].timeout),t.error)Object.defineProperty(t.error,"__request_id",{value:t.id}),this.queue[t.id].promise[1](t.error);else{let e=t.result;e&&(e=Object.defineProperty(Object(e),"__request_id",{value:t.id})),this.queue[t.id].promise[0](e)}this.queue[t.id]=null})),this.socket.addEventListener("error",(t=>this.emit("error",t))),this.socket.addEventListener("close",(({code:n,reason:r})=>{this.ready&&setTimeout((()=>this.emit("close",n,r)),0),this.ready=!1,this.socket=void 0,1e3!==n&&(this.current_reconnects++,this.reconnect&&(this.max_reconnects>this.current_reconnects||0===this.max_reconnects)&&setTimeout((()=>this._connect(t,e)),this.reconnect_interval))}))}}class a extends c{constructor(t="ws://localhost:8080",{autoconnect:e=!0,reconnect:n=!0,reconnect_interval:r=1e3,max_reconnects:o=5}={},s){super(i,t,{autoconnect:e,reconnect:n,reconnect_interval:r,max_reconnects:o},s)}}var u=r.K;export{u as Client};